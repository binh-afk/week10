import os
import json
from datetime import datetime

class ShopesenseiBackend:
    def __init__(self):
        self.users = {}
        self.products = {}
        self.orders = {}
        self.cart = {}
        self.current_user = None
        self.product_id_counter = 1
        self.order_id_counter = 1
        
        # ThÃªm sáºµn má»™t sá»‘ sáº£n pháº©m máº«u
        self._init_sample_data()
    
    def _init_sample_data(self):
        """Khá»Ÿi táº¡o dá»¯ liá»‡u máº«u"""
        sample_products = [
            {"name": "iPhone 15 Pro", "price": 25000000, "stock": 10, "category": "Äiá»‡n thoáº¡i"},
            {"name": "Samsung Galaxy S24", "price": 20000000, "stock": 15, "category": "Äiá»‡n thoáº¡i"},
            {"name": "Ão thun nam", "price": 150000, "stock": 50, "category": "Thá»i trang"},
            {"name": "GiÃ y sneaker", "price": 500000, "stock": 30, "category": "GiÃ y dÃ©p"},
            {"name": "Tai nghe AirPods", "price": 4000000, "stock": 20, "category": "Phá»¥ kiá»‡n"},
        ]
        
        for product in sample_products:
            self.products[self.product_id_counter] = product
            self.product_id_counter += 1
    
    def clear_screen(self):
        """XÃ³a mÃ n hÃ¬nh terminal"""
        os.system('cls' if os.name == 'nt' else 'clear')
    
    def display_header(self, title):
        """Hiá»ƒn thá»‹ header"""
        print("\n" + "="*60)
        print(f"{'ğŸ›ï¸  SHOPSENSEI':^60}")
        print("="*60)
        print(f"{title:^60}")
        print("="*60 + "\n")
    
    def register_user(self):
        """ÄÄƒng kÃ½ ngÆ°á»i dÃ¹ng má»›i"""
        self.clear_screen()
        self.display_header("ÄÄ‚NG KÃ TÃ€I KHOáº¢N")
        
        username = input("Nháº­p tÃªn Ä‘Äƒng nháº­p: ").strip()
        if username in self.users:
            print("âŒ TÃªn Ä‘Äƒng nháº­p Ä‘Ã£ tá»“n táº¡i!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
            return False
        
        password = input("Nháº­p máº­t kháº©u: ").strip()
        email = input("Nháº­p email: ").strip()
        phone = input("Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i: ").strip()
        
        self.users[username] = {
            "password": password,
            "email": email,
            "phone": phone,
            "created_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        }
        self.cart[username] = []
        
        print(f"\nâœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng! ChÃ o má»«ng {username}")
        input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
        return True
    
    def login(self):
        """ÄÄƒng nháº­p"""
        self.clear_screen()
        self.display_header("ÄÄ‚NG NHáº¬P")
        
        username = input("TÃªn Ä‘Äƒng nháº­p: ").strip()
        password = input("Máº­t kháº©u: ").strip()
        
        if username in self.users and self.users[username]["password"] == password:
            self.current_user = username
            print(f"\nâœ… ÄÄƒng nháº­p thÃ nh cÃ´ng! Xin chÃ o {username}")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
            return True
        else:
            print("\nâŒ Sai tÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
            return False
    
    def view_products(self):
        """Xem danh sÃ¡ch sáº£n pháº©m"""
        self.clear_screen()
        self.display_header("DANH SÃCH Sáº¢N PHáº¨M")
        
        if not self.products:
            print("ChÆ°a cÃ³ sáº£n pháº©m nÃ o!")
            input("\nNháº¥n Enter Ä‘á»ƒ quay láº¡i...")
            return
        
        print(f"{'ID':<5} {'TÃªn sáº£n pháº©m':<30} {'GiÃ¡':<15} {'Kho':<10} {'Danh má»¥c':<15}")
        print("-" * 75)
        
        for pid, product in self.products.items():
            print(f"{pid:<5} {product['name']:<30} {product['price']:>12,}Ä‘ {product['stock']:>8} {product['category']:<15}")
        
        print("\nChá»n hÃ nh Ä‘á»™ng:")
        print("1. ThÃªm sáº£n pháº©m vÃ o giá» hÃ ng")
        print("2. TÃ¬m kiáº¿m sáº£n pháº©m")
        print("0. Quay láº¡i")
        
        choice = input("\nNháº­p lá»±a chá»n: ").strip()
        
        if choice == "1":
            self.add_to_cart()
        elif choice == "2":
            self.search_products()
    
    def search_products(self):
        """TÃ¬m kiáº¿m sáº£n pháº©m"""
        keyword = input("\nNháº­p tá»« khÃ³a tÃ¬m kiáº¿m: ").strip().lower()
        
        results = {pid: p for pid, p in self.products.items() 
                   if keyword in p['name'].lower() or keyword in p['category'].lower()}
        
        if results:
            print(f"\nğŸ” TÃ¬m tháº¥y {len(results)} sáº£n pháº©m:\n")
            print(f"{'ID':<5} {'TÃªn sáº£n pháº©m':<30} {'GiÃ¡':<15} {'Kho':<10}")
            print("-" * 60)
            for pid, product in results.items():
                print(f"{pid:<5} {product['name']:<30} {product['price']:>12,}Ä‘ {product['stock']:>8}")
            
            # Hiá»ƒn thá»‹ gá»£i Ã½ sáº£n pháº©m
            self.show_recommendations(results)
        else:
            print("\nâŒ KhÃ´ng tÃ¬m tháº¥y sáº£n pháº©m nÃ o!")
            # Váº«n hiá»ƒn thá»‹ gá»£i Ã½ dá»±a trÃªn tá»« khÃ³a
            self.show_recommendations({})
        
        input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
    
    def show_recommendations(self, search_results):
        """Hiá»ƒn thá»‹ sáº£n pháº©m gá»£i Ã½"""
        print("\n" + "="*60)
        print("ğŸ’¡ Sáº¢N PHáº¨M Gá»¢I Ã CHO Báº N")
        print("="*60)
        
        # Láº¥y danh má»¥c tá»« káº¿t quáº£ tÃ¬m kiáº¿m
        categories = set()
        for product in search_results.values():
            categories.add(product['category'])
        
        # Náº¿u khÃ´ng cÃ³ káº¿t quáº£ tÃ¬m kiáº¿m, láº¥y sáº£n pháº©m phá»• biáº¿n
        if not categories:
            print("\nğŸ”¥ Sáº£n pháº©m phá»• biáº¿n:\n")
            recommended = list(self.products.items())[:5]
            
            if recommended:
                print(f"{'ID':<5} {'TÃªn sáº£n pháº©m':<30} {'GiÃ¡':<15} {'Danh má»¥c':<15}")
                print("-" * 65)
                for pid, product in recommended:
                    print(f"{pid:<5} {product['name']:<30} {product['price']:>12,}Ä‘ {product['category']:<15}")
        else:
            # Gá»£i Ã½ sáº£n pháº©m cÃ¹ng danh má»¥c (loáº¡i trá»« sáº£n pháº©m Ä‘Ã£ cÃ³ trong káº¿t quáº£ tÃ¬m kiáº¿m)
            same_category = [(pid, p) for pid, p in self.products.items() 
                           if p['category'] in categories and pid not in search_results]
            
            # Láº¥y sáº£n pháº©m tá»« danh má»¥c khÃ¡c
            other_category = [(pid, p) for pid, p in self.products.items() 
                            if pid not in search_results and p['category'] not in categories]
            
            # Hiá»ƒn thá»‹ sáº£n pháº©m cÃ¹ng danh má»¥c
            if same_category:
                print(f"\nğŸ¯ Sáº£n pháº©m cÃ¹ng danh má»¥c ({', '.join(categories)}):\n")
                print(f"{'ID':<5} {'TÃªn sáº£n pháº©m':<30} {'GiÃ¡':<15} {'Danh má»¥c':<15}")
                print("-" * 65)
                for pid, product in same_category[:5]:
                    print(f"{pid:<5} {product['name']:<30} {product['price']:>12,}Ä‘ {product['category']:<15}")
            
            # Hiá»ƒn thá»‹ sáº£n pháº©m danh má»¥c khÃ¡c (náº¿u cáº§n)
            if len(same_category) < 5 and other_category:
                print(f"\nğŸ CÃ³ thá»ƒ báº¡n cÅ©ng thÃ­ch:\n")
                print(f"{'ID':<5} {'TÃªn sáº£n pháº©m':<30} {'GiÃ¡':<15} {'Danh má»¥c':<15}")
                print("-" * 65)
                remaining = 5 - len(same_category)
                for pid, product in other_category[:remaining]:
                    print(f"{pid:<5} {product['name']:<30} {product['price']:>12,}Ä‘ {product['category']:<15}")
            
            # Náº¿u khÃ´ng cÃ³ gá»£i Ã½ nÃ o
            if not same_category and not other_category:
                print("\nKhÃ´ng cÃ³ sáº£n pháº©m gá»£i Ã½ nÃ o!")
    
    def add_to_cart(self):
        """ThÃªm sáº£n pháº©m vÃ o giá» hÃ ng"""
        if not self.current_user:
            print("\nâŒ Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ thÃªm vÃ o giá» hÃ ng!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
            return
        
        try:
            pid = int(input("\nNháº­p ID sáº£n pháº©m: "))
            if pid not in self.products:
                print("âŒ Sáº£n pháº©m khÃ´ng tá»“n táº¡i!")
                input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
                return
            
            quantity = int(input("Nháº­p sá»‘ lÆ°á»£ng: "))
            if quantity <= 0:
                print("âŒ Sá»‘ lÆ°á»£ng pháº£i lá»›n hÆ¡n 0!")
                input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
                return
            
            if quantity > self.products[pid]['stock']:
                print(f"âŒ KhÃ´ng Ä‘á»§ hÃ ng! CÃ²n láº¡i: {self.products[pid]['stock']}")
                input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
                return
            
            # Kiá»ƒm tra sáº£n pháº©m Ä‘Ã£ cÃ³ trong giá» chÆ°a
            existing = next((item for item in self.cart[self.current_user] if item['product_id'] == pid), None)
            if existing:
                existing['quantity'] += quantity
            else:
                self.cart[self.current_user].append({
                    'product_id': pid,
                    'quantity': quantity
                })
            
            print(f"\nâœ… ÄÃ£ thÃªm {quantity} {self.products[pid]['name']} vÃ o giá» hÃ ng!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
        except ValueError:
            print("âŒ Vui lÃ²ng nháº­p sá»‘ há»£p lá»‡!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
    
    def view_cart(self):
        """Xem giá» hÃ ng"""
        self.clear_screen()
        self.display_header("GIá» HÃ€NG Cá»¦A Báº N")
        
        if not self.current_user:
            print("âŒ Vui lÃ²ng Ä‘Äƒng nháº­p!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
            return
        
        cart_items = self.cart.get(self.current_user, [])
        
        if not cart_items:
            print("Giá» hÃ ng trá»‘ng!")
            input("\nNháº¥n Enter Ä‘á»ƒ quay láº¡i...")
            return
        
        total = 0
        print(f"{'Sáº£n pháº©m':<30} {'Sá»‘ lÆ°á»£ng':<10} {'ÄÆ¡n giÃ¡':<15} {'ThÃ nh tiá»n':<15}")
        print("-" * 70)
        
        for item in cart_items:
            product = self.products[item['product_id']]
            subtotal = product['price'] * item['quantity']
            total += subtotal
            print(f"{product['name']:<30} {item['quantity']:<10} {product['price']:>12,}Ä‘ {subtotal:>12,}Ä‘")
        
        print("-" * 70)
        print(f"{'Tá»”NG Cá»˜NG:':<55} {total:>12,}Ä‘")
        
        print("\nChá»n hÃ nh Ä‘á»™ng:")
        print("1. Thanh toÃ¡n")
        print("2. XÃ³a sáº£n pháº©m khá»i giá» hÃ ng")
        print("0. Quay láº¡i")
        
        choice = input("\nNháº­p lá»±a chá»n: ").strip()
        
        if choice == "1":
            self.checkout()
        elif choice == "2":
            self.remove_from_cart()
    
    def remove_from_cart(self):
        """XÃ³a sáº£n pháº©m khá»i giá» hÃ ng"""
        try:
            pid = int(input("\nNháº­p ID sáº£n pháº©m muá»‘n xÃ³a: "))
            cart_items = self.cart[self.current_user]
            
            for i, item in enumerate(cart_items):
                if item['product_id'] == pid:
                    del cart_items[i]
                    print(f"\nâœ… ÄÃ£ xÃ³a {self.products[pid]['name']} khá»i giá» hÃ ng!")
                    input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
                    return
            
            print("âŒ KhÃ´ng tÃ¬m tháº¥y sáº£n pháº©m trong giá» hÃ ng!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
        except ValueError:
            print("âŒ Vui lÃ²ng nháº­p sá»‘ há»£p lá»‡!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
    
    def checkout(self):
        """Thanh toÃ¡n"""
        self.clear_screen()
        self.display_header("THANH TOÃN")
        
        cart_items = self.cart[self.current_user]
        total = sum(self.products[item['product_id']]['price'] * item['quantity'] for item in cart_items)
        
        print(f"Tá»•ng tiá»n: {total:,}Ä‘")
        print("\nPhÆ°Æ¡ng thá»©c thanh toÃ¡n:")
        print("1. Thanh toÃ¡n khi nháº­n hÃ ng (COD)")
        print("2. Chuyá»ƒn khoáº£n ngÃ¢n hÃ ng")
        print("3. VÃ­ Ä‘iá»‡n tá»­")
        
        payment = input("\nChá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n: ").strip()
        
        if payment not in ["1", "2", "3"]:
            print("âŒ PhÆ°Æ¡ng thá»©c thanh toÃ¡n khÃ´ng há»£p lá»‡!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
            return
        
        address = input("Nháº­p Ä‘á»‹a chá»‰ giao hÃ ng: ").strip()
        
        # Táº¡o Ä‘Æ¡n hÃ ng
        order_id = self.order_id_counter
        self.orders[order_id] = {
            "user": self.current_user,
            "items": cart_items.copy(),
            "total": total,
            "payment_method": ["COD", "Chuyá»ƒn khoáº£n", "VÃ­ Ä‘iá»‡n tá»­"][int(payment)-1],
            "address": address,
            "status": "Chá» xÃ¡c nháº­n",
            "created_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        }
        self.order_id_counter += 1
        
        # Cáº­p nháº­t kho
        for item in cart_items:
            self.products[item['product_id']]['stock'] -= item['quantity']
        
        # XÃ³a giá» hÃ ng
        self.cart[self.current_user] = []
        
        print(f"\nâœ… Äáº·t hÃ ng thÃ nh cÃ´ng! MÃ£ Ä‘Æ¡n hÃ ng: #{order_id}")
        print(f"Tá»•ng tiá»n: {total:,}Ä‘")
        print(f"Äá»‹a chá»‰: {address}")
        input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
    
    def view_orders(self):
        """Xem Ä‘Æ¡n hÃ ng"""
        self.clear_screen()
        self.display_header("Äá»–N HÃ€NG Cá»¦A Báº N")
        
        if not self.current_user:
            print("âŒ Vui lÃ²ng Ä‘Äƒng nháº­p!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
            return
        
        user_orders = {oid: o for oid, o in self.orders.items() if o['user'] == self.current_user}
        
        if not user_orders:
            print("Báº¡n chÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o!")
            input("\nNháº¥n Enter Ä‘á»ƒ quay láº¡i...")
            return
        
        for oid, order in user_orders.items():
            print(f"\nğŸ“¦ ÄÆ¡n hÃ ng #{oid}")
            print(f"Tráº¡ng thÃ¡i: {order['status']}")
            print(f"NgÃ y Ä‘áº·t: {order['created_at']}")
            print(f"Tá»•ng tiá»n: {order['total']:,}Ä‘")
            print(f"Thanh toÃ¡n: {order['payment_method']}")
            print(f"Äá»‹a chá»‰: {order['address']}")
            print("Sáº£n pháº©m:")
            for item in order['items']:
                product = self.products[item['product_id']]
                print(f"  - {product['name']} x{item['quantity']}")
            print("-" * 60)
        
        input("\nNháº¥n Enter Ä‘á»ƒ quay láº¡i...")
    
    def seller_menu(self):
        """Menu ngÆ°á»i bÃ¡n"""
        while True:
            self.clear_screen()
            self.display_header("QUáº¢N LÃ NGÆ¯á»œI BÃN")
            
            print("1. ThÃªm sáº£n pháº©m má»›i")
            print("2. Xem danh sÃ¡ch sáº£n pháº©m")
            print("3. Cáº­p nháº­t sáº£n pháº©m")
            print("4. XÃ³a sáº£n pháº©m")
            print("5. Xem Ä‘Æ¡n hÃ ng")
            print("0. Quay láº¡i")
            
            choice = input("\nNháº­p lá»±a chá»n: ").strip()
            
            if choice == "1":
                self.add_product()
            elif choice == "2":
                self.view_products()
            elif choice == "3":
                self.update_product()
            elif choice == "4":
                self.delete_product()
            elif choice == "5":
                self.view_all_orders()
            elif choice == "0":
                break
    
    def add_product(self):
        """ThÃªm sáº£n pháº©m má»›i"""
        self.clear_screen()
        self.display_header("THÃŠM Sáº¢N PHáº¨M Má»šI")
        
        name = input("TÃªn sáº£n pháº©m: ").strip()
        try:
            price = int(input("GiÃ¡ (VNÄ): "))
            stock = int(input("Sá»‘ lÆ°á»£ng: "))
            category = input("Danh má»¥c: ").strip()
            
            self.products[self.product_id_counter] = {
                "name": name,
                "price": price,
                "stock": stock,
                "category": category
            }
            
            print(f"\nâœ… ÄÃ£ thÃªm sáº£n pháº©m #{self.product_id_counter} thÃ nh cÃ´ng!")
            self.product_id_counter += 1
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
        except ValueError:
            print("âŒ Vui lÃ²ng nháº­p sá»‘ há»£p lá»‡!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
    
    def update_product(self):
        """Cáº­p nháº­t sáº£n pháº©m"""
        self.clear_screen()
        self.display_header("Cáº¬P NHáº¬T Sáº¢N PHáº¨M")
        
        try:
            pid = int(input("Nháº­p ID sáº£n pháº©m: "))
            if pid not in self.products:
                print("âŒ Sáº£n pháº©m khÃ´ng tá»“n táº¡i!")
                input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
                return
            
            product = self.products[pid]
            print(f"\nSáº£n pháº©m hiá»‡n táº¡i: {product['name']}")
            print(f"GiÃ¡: {product['price']:,}Ä‘ | Kho: {product['stock']} | Danh má»¥c: {product['category']}")
            
            print("\nNháº­p thÃ´ng tin má»›i (Enter Ä‘á»ƒ giá»¯ nguyÃªn):")
            name = input(f"TÃªn [{product['name']}]: ").strip()
            price = input(f"GiÃ¡ [{product['price']:,}Ä‘]: ").strip()
            stock = input(f"Kho [{product['stock']}]: ").strip()
            category = input(f"Danh má»¥c [{product['category']}]: ").strip()
            
            if name:
                product['name'] = name
            if price:
                product['price'] = int(price)
            if stock:
                product['stock'] = int(stock)
            if category:
                product['category'] = category
            
            print("\nâœ… Cáº­p nháº­t sáº£n pháº©m thÃ nh cÃ´ng!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
        except ValueError:
            print("âŒ Vui lÃ²ng nháº­p sá»‘ há»£p lá»‡!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
    
    def delete_product(self):
        """XÃ³a sáº£n pháº©m"""
        try:
            pid = int(input("\nNháº­p ID sáº£n pháº©m muá»‘n xÃ³a: "))
            if pid in self.products:
                product_name = self.products[pid]['name']
                del self.products[pid]
                print(f"\nâœ… ÄÃ£ xÃ³a sáº£n pháº©m {product_name}!")
            else:
                print("âŒ Sáº£n pháº©m khÃ´ng tá»“n táº¡i!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
        except ValueError:
            print("âŒ Vui lÃ²ng nháº­p sá»‘ há»£p lá»‡!")
            input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
    
    def view_all_orders(self):
        """Xem táº¥t cáº£ Ä‘Æ¡n hÃ ng"""
        self.clear_screen()
        self.display_header("Táº¤T Cáº¢ ÄÆ N HÃ€NG")
        
        if not self.orders:
            print("ChÆ°a cÃ³ Ä‘Æ¡n hÃ ng nÃ o!")
            input("\nNháº¥n Enter Ä‘á»ƒ quay láº¡i...")
            return
        
        for oid, order in self.orders.items():
            print(f"\nğŸ“¦ ÄÆ¡n hÃ ng #{oid}")
            print(f"KhÃ¡ch hÃ ng: {order['user']}")
            print(f"Tráº¡ng thÃ¡i: {order['status']}")
            print(f"Tá»•ng tiá»n: {order['total']:,}Ä‘")
            print(f"NgÃ y Ä‘áº·t: {order['created_at']}")
            print("-" * 60)
        
        input("\nNháº¥n Enter Ä‘á»ƒ quay láº¡i...")
    
    def run(self):
        """Cháº¡y á»©ng dá»¥ng"""
        while True:
            self.clear_screen()
            self.display_header("MENU CHÃNH")
            
            if self.current_user:
                print(f"ğŸ‘¤ ÄÄƒng nháº­p: {self.current_user}\n")
                print("1. Xem sáº£n pháº©m")
                print("2. Giá» hÃ ng")
                print("3. ÄÆ¡n hÃ ng cá»§a tÃ´i")
                print("4. Quáº£n lÃ½ ngÆ°á»i bÃ¡n")
                print("5. ÄÄƒng xuáº¥t")
                print("0. ThoÃ¡t")
            else:
                print("1. ÄÄƒng nháº­p")
                print("2. ÄÄƒng kÃ½")
                print("3. Xem sáº£n pháº©m (khÃ¡ch)")
                print("0. ThoÃ¡t")
            
            choice = input("\nNháº­p lá»±a chá»n: ").strip()
            
            if not self.current_user:
                if choice == "1":
                    self.login()
                elif choice == "2":
                    self.register_user()
                elif choice == "3":
                    self.view_products()
                elif choice == "0":
                    print("\nğŸ‘‹ Cáº£m Æ¡n báº¡n Ä‘Ã£ sá»­ dá»¥ng Shopsensei!")
                    break
            else:
                if choice == "1":
                    self.view_products()
                elif choice == "2":
                    self.view_cart()
                elif choice == "3":
                    self.view_orders()
                elif choice == "4":
                    self.seller_menu()
                elif choice == "5":
                    self.current_user = None
                    print("\nâœ… ÄÃ£ Ä‘Äƒng xuáº¥t!")
                    input("\nNháº¥n Enter Ä‘á»ƒ tiáº¿p tá»¥c...")
                elif choice == "0":
                    print("\nğŸ‘‹ Cáº£m Æ¡n báº¡n Ä‘Ã£ sá»­ dá»¥ng Shopsensei!")
                    break

if __name__ == "__main__":
    app = ShopesenseiBackend()
    app.run()
